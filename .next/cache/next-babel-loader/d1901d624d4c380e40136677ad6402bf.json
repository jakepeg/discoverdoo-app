{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport auth0 from 'auth0-js';\nimport Cookies from 'js-cookie';\nimport { getUserFavourites } from '../actions';\nvar CLIENT_URL = process.env.CLIENT_URL;\n\nvar Auth0 = /*#__PURE__*/function () {\n  function Auth0() {\n    _classCallCheck(this, Auth0);\n\n    this.auth0 = new auth0.WebAuth({\n      domain: 'jakepeg.eu.auth0.com',\n      clientID: '6w0luoKEKUH4QLOImluA81kNf3jLmWbr',\n      redirectUri: \"\".concat(CLIENT_URL, \"/callback\"),\n      responseType: 'token id_token',\n      scope: 'openid profile'\n    });\n    this.login = this.login.bind(this);\n    this.loginAddActivity = this.loginAddActivity.bind(this);\n    this.logout = this.logout.bind(this);\n    this.handleAuthentication = this.handleAuthentication.bind(this);\n    this.isAuthenticated = this.isAuthenticated.bind(this);\n  }\n\n  _createClass(Auth0, [{\n    key: \"handleAuthentication\",\n    value: function handleAuthentication() {\n      var _this = this;\n\n      return new Promise(function (resolve, reject) {\n        _this.auth0.parseHash(function (err, authResult) {\n          if (authResult && authResult.accessToken && authResult.idToken) {\n            _this.setSession(authResult);\n\n            resolve();\n          } else if (err) {\n            reject(err);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"setSession\",\n    value: function setSession(authResult) {\n      // let expiresAt = JSON.stringify((authResult.expiresIn * 1000) + new Date().getTime())\n      var date = new Date();\n      var expiresAt = date.setDate(date.getDate() + 1);\n      Cookies.set('user', authResult.idTokenPayload, {\n        expires: 1\n      });\n      Cookies.set('jwt', authResult.idToken, {\n        expires: 1\n      });\n      Cookies.set('expiresAt', expiresAt, {\n        expires: 1\n      });\n      Cookies.set('sub', authResult.idTokenPayload.sub, {\n        expires: 1\n      });\n      console.log(\"set Session\");\n    }\n  }, {\n    key: \"setSession\",\n    value: function setSession() {\n      getUserFavourites(Cookies.get('sub')).then(function (data) {\n        return Cookies.set('favourites', data, {\n          expires: 1\n        });\n      });\n    }\n  }, {\n    key: \"logout\",\n    value: function logout() {\n      Cookies.remove('user');\n      Cookies.remove('jwt');\n      Cookies.remove('expiresAt');\n      Cookies.remove('sub');\n      Cookies.remove('returnURL');\n      this.auth0.logout({\n        returnTo: CLIENT_URL,\n        clientID: '6w0luoKEKUH4QLOImluA81kNf3jLmWbr'\n      });\n    }\n  }, {\n    key: \"login\",\n    value: function login() {\n      Cookies.set('returnURL', '/');\n      this.auth0.authorize();\n    }\n  }, {\n    key: \"loginAddActivity\",\n    value: function loginAddActivity() {\n      Cookies.set('returnURL', '/create');\n      this.auth0.authorize();\n    }\n  }, {\n    key: \"isAuthenticated\",\n    value: function isAuthenticated() {\n      var expiresAt = Cookies.get('expiresAt');\n      return new Date().getTime() < expiresAt;\n    }\n  }]);\n\n  return Auth0;\n}();\n\nvar auth0Client = new Auth0();\nexport default auth0Client;","map":{"version":3,"sources":["/Users/Dev/Dev/discoverdoo-app/services/auth0.js"],"names":["auth0","Cookies","getUserFavourites","CLIENT_URL","process","env","Auth0","WebAuth","domain","clientID","redirectUri","responseType","scope","login","bind","loginAddActivity","logout","handleAuthentication","isAuthenticated","Promise","resolve","reject","parseHash","err","authResult","accessToken","idToken","setSession","date","Date","expiresAt","setDate","getDate","set","idTokenPayload","expires","sub","console","log","get","then","data","remove","returnTo","authorize","getTime","auth0Client"],"mappings":"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","sourcesContent":["import auth0 from 'auth0-js'\nimport Cookies from 'js-cookie'\nimport { getUserFavourites } from '../actions'\n\nconst CLIENT_URL = process.env.CLIENT_URL;\n\nclass Auth0 {\n\n  constructor() {\n    this.auth0 = new auth0.WebAuth({\n      domain: 'jakepeg.eu.auth0.com',\n      clientID: '6w0luoKEKUH4QLOImluA81kNf3jLmWbr',\n      redirectUri: `${CLIENT_URL}/callback`,\n      responseType: 'token id_token',\n      scope: 'openid profile'\n    });\n\n    this.login = this.login.bind(this);\n    this.loginAddActivity = this.loginAddActivity.bind(this);\n    this.logout = this.logout.bind(this);\n    this.handleAuthentication = this.handleAuthentication.bind(this);\n    this.isAuthenticated = this.isAuthenticated.bind(this);\n  }\n\n  handleAuthentication() {\n    return new Promise((resolve, reject) => {\n      this.auth0.parseHash((err, authResult) => {\n        if (authResult && authResult.accessToken && authResult.idToken) {\n          this.setSession(authResult);\n          resolve();\n        } else if (err) {\n          reject(err);\n        }\n      });\n    })\n  }\n\n  setSession(authResult) {\n    // let expiresAt = JSON.stringify((authResult.expiresIn * 1000) + new Date().getTime())\n    let date = new Date();\n    let expiresAt = date.setDate(date.getDate() + 1);\n    Cookies.set('user', authResult.idTokenPayload, { expires: 1 })\n    Cookies.set('jwt', authResult.idToken, { expires: 1 })\n    Cookies.set('expiresAt', expiresAt, { expires: 1 })\n    Cookies.set('sub', authResult.idTokenPayload.sub, { expires: 1 })\n    console.log(\"set Session\")\n  }\n\n  setSession() {\n    getUserFavourites(Cookies.get('sub')).then(data => Cookies.set('favourites', data, { expires: 1 }))\n   }\n\n  logout() {\n    Cookies.remove('user')\n    Cookies.remove('jwt')\n    Cookies.remove('expiresAt')\n    Cookies.remove('sub')\n    Cookies.remove('returnURL')\n\n    this.auth0.logout({\n      returnTo: CLIENT_URL,\n      clientID: '6w0luoKEKUH4QLOImluA81kNf3jLmWbr'\n    })\n  }\n\n  login() {\n    Cookies.set('returnURL', '/')\n    this.auth0.authorize()\n  }\n\n  loginAddActivity() {\n    Cookies.set('returnURL', '/create')\n    this.auth0.authorize()\n  }\n\n  isAuthenticated() {\n    const expiresAt = Cookies.get('expiresAt')\n    return new Date().getTime() < expiresAt;\n    }\n}\n\nconst auth0Client = new Auth0();\n\nexport default auth0Client"]},"metadata":{},"sourceType":"module"}